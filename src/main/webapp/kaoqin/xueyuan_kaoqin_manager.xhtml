<?xml version='1.0' encoding='GBK' ?>

<!DOCTYPE html>
<h:html xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head />
<h:body>
	<f:view>
		<p:layout fullPage="true">

			<p:layoutUnit position="north" size="50">
				<p:outputPanel>
          	京美舞集教学管理系统
        </p:outputPanel>
			</p:layoutUnit>
			<p:layoutUnit position="west" resizable="true" size="150">
				<p:accordionPanel activeIndex="2">
					<p:tab title="学员管理">
						<p:link href="/xueyuan/xueyuan_manager.xhtml" value="学员管理" />
					</p:tab>
					<p:tab title="班级管理">
						<p:link href="/banji/banji_manager.xhtml" value="班级管理" />
					</p:tab>
					<p:tab title="考勤管理">
						<p:tab title="学员考勤">
							<h:panelGrid columns="1">
								<p:commandLink process="@this" update="@all">
									<h:outputText value="学员考勤登记" />
									<f:setPropertyActionListener value="3"
										target="#{xueyuanManagmentBean.activeIndex}"></f:setPropertyActionListener>
								</p:commandLink>
							</h:panelGrid>
						</p:tab>
					</p:tab>
				</p:accordionPanel>
			</p:layoutUnit>

			<p:layoutUnit position="center">
				<p:tabView id="kaoqintabs">
					<p:tab title="学员考勤登记">

						<p:panel header="学员考勤登记">
							<h:form id="form1">
								<p:panelGrid columns="4" layout="tabular">
									<p:outputLabel for="classesid2" value="所在班级" />
									<p:selectOneMenu id="classesid2"
										value="#{xueyuanBean.classesid}">
										<f:selectItems value="#{banjiManagmentBean.banjiList}"
											var="banji" itemLabel="#{banji.name}"
											itemValue="#{banji.name}" />
									</p:selectOneMenu>
									<p:commandButton id="querybyclass" value="查询"
										actionListener="#{xueyuanManagmentBean.querybyclassid}"
										update="@form:@parent:kaoqinform:xueyuankaoqintable">
									</p:commandButton>

								</p:panelGrid>
							</h:form>
							<p:separator></p:separator>
							<h:form id="kaoqinform">
								<p:messages id="savemsg" for="saveKaoQin"
									severity="info,warn,error" />
								<p:panelGrid columns="8" layout="tabular">
									<p:outputLabel value="上课时间" />
									<p:calendar id="timesheettime" required="true"
										value="#{kaoqinManagementBean.timesheettime}"
										pattern="yyyy/MM/dd" showOn="button">
									</p:calendar>
									<p:outputLabel value="课时 （小时）" />
									<p:spinner id="classhours"
										value="#{kaoqinManagementBean.classhours}" min="0.5"
										max="10.0" stepFactor="0.5" required="true" />
									<p:separator></p:separator>
									<p:commandButton id="save1" value="保存"
										actionListener="#{kaoqinManagementBean.save}"
										update="kaoqinform"></p:commandButton>

								</p:panelGrid>

								<p:dataTable id="xueyuankaoqintable" var="xueyuan"
									value="#{xueyuanManagmentBean.xueyuanQueryList}"
									paginator="false" resizableColumns="true" liveResize="true"
									rowIndexVar="index" emptyMessage="没有相应结果">
									<p:column>
										<f:facet name="header">
											<h:outputText value="学员姓名" />
										</f:facet>
										<h:outputText value="#{xueyuan.name}" />

										<h:inputHidden id="studentId" value="#{xueyuan.id}"></h:inputHidden>
										<h:inputHidden id="studentName" value="#{xueyuan.name}"></h:inputHidden>
										<input type="hidden" name="className"
											value="#{xueyuanBean.classesid}" />
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText value="班级名称" />
										</f:facet>
										<h:outputText value="#{xueyuan.classesid}">
										</h:outputText>
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText value="上课状态" />
										</f:facet>

										<p:selectOneMenu id="studentstatus">
											<f:selectItem itemLabel="上课" itemValue="上课" />
											<f:selectItem itemLabel="请假" itemValue="请假" />
											<f:selectItem itemLabel="顺延" itemValue="顺延" />
											<f:selectItem itemLabel="空白" itemValue="空白" />
										</p:selectOneMenu>
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText value="评价" />
										</f:facet>
										<p:rating id="studentrating" value="5" />
									</p:column>

								</p:dataTable>

							</h:form>
						</p:panel>
					</p:tab>
					<p:tab title="学员考勤补录">
						<p:panel header="考勤补录">
							<h:form id="kaoqinbuluform">
								<p:messages for="additionsaveKaoQin" severity="info,warn,error" />
								<p:panelGrid columns="8" layout="tabular">
									<p:outputLabel value="上课时间" />
									<p:calendar id="bulutimesheettime" required="true"
										value="#{kaoqinManagementBean.timesheettime}"
										pattern="yyyy/MM/dd" showOn="button">
									</p:calendar>
									<p:separator></p:separator>
									<p:commandButton id="add" value="新增考勤记录"
										actionListener="#{kaoqinManagementBean.add}"
										update="kaoqinbuluform"></p:commandButton>
									<p:commandButton id="save2" value="保存"
										actionListener="#{kaoqinManagementBean.additionsave}"
										update="kaoqinbuluform"></p:commandButton>
								</p:panelGrid>
								<p:separator />
								<div class="ui-datatable ui-widget ui-datatable-tablewrapper">
									<table role="grid">
										<thead>
											<tr role="row">
												<th role="columnheader" class="ui-state-default"><h:outputText
														value="学员姓名" /></th>
												<th role="columnheader" class="ui-state-default"><h:outputText
														value="班级名称" /></th>
												<th role="columnheader" class="ui-state-default"><h:outputText
														value="课时（小时）" /></th>
												<th role="columnheader" class="ui-state-default"><h:outputText
														value="上课状态" /></th>
												<th role="columnheader" class="ui-state-default"><h:outputText
														value="评价" /></th>
											</tr>
										</thead>
										<tbody class="ui-datatable-data ui-widget-content">
											<c:forEach var="kaoqinBean"
												items="#{kaoqinManagementBean.inputKaoQinList}"
												varStatus="status">
												<tr class="ui-widget-content ui-datatable-even" role="row">
													<td role="gridcell" class="ui-editable-column"><p:selectOneMenu
															id="bulustudentname" value="#{kaoqinBean.studentid}"
															style="padding-right: 0em; width: 100%">
															<f:selectItems
																value="#{xueyuanManagmentBean.xueyuanList}"
																var="xueyuan" itemLabel="#{xueyuan.name}"
																itemValue="#{xueyuan.id}" />
														</p:selectOneMenu></td>
													<td role="gridcell" class="ui-editable-column"><p:selectOneMenu
															id="buluclassname" value="#{kaoqinBean.classname}"
															style="padding-right: 0em; width: 100%">
															<f:selectItems value="#{banjiManagmentBean.banjiList}"
																var="banji" itemLabel="#{banji.name}"
																itemValue="#{banji.name}" />
														</p:selectOneMenu></td>
													<td role="gridcell" class="ui-editable-column"><p:inputText
															value="#{kaoqinBean.classhours}" type="number"
															style="padding-right: 0em; width: 100%" /></td>
													<td role="gridcell" class="ui-editable-column"><p:selectOneMenu
															id="bulustatus" value="#{kaoqinBean.status}"
															style="padding-right: 0em; width: 100%">
															<f:selectItem itemLabel="上课" itemValue="上课" />
															<f:selectItem itemLabel="请假" itemValue="请假" />
															<f:selectItem itemLabel="顺延" itemValue="顺延" />
															<f:selectItem itemLabel="空白" itemValue="空白" />
														</p:selectOneMenu></td>
													<td role="gridcell" class="ui-editable-column"><p:rating
															id="bulustudentrating" value="#{kaoqinBean.rating}"
															style="padding-right: 0em; width: 100%" /></td>
												</tr>
											</c:forEach>
										</tbody>
									</table>
								</div>
							</h:form>
						</p:panel>
					</p:tab>
					<p:tab title="班级考勤记录">
						<p:panel header="考勤记录查询">
							<h:form id="form2">
								<p:panelGrid columns="4" layout="tabular">
									<p:outputLabel for="className" value="所在班级" />
									<p:selectOneMenu id="className"
										value="#{kaoqinManagementBean.className}">
										<f:selectItems value="#{banjiManagmentBean.banjiList}"
											var="banji" itemLabel="#{banji.name}"
											itemValue="#{banji.name}" />
									</p:selectOneMenu>
									<p:commandButton id="querykaoqinbyclass" value="查询"
										actionListener="#{kaoqinManagementBean.querybyclassname}"
										update="@form:kaoqintable1">
									</p:commandButton>

								</p:panelGrid>

								<p:separator></p:separator>

								<p:dataTable id="kaoqintable1" var="kaoqin"
									value="#{kaoqinManagementBean.kaoqinQueryList}" editable="true"
									paginator="true" rows="50" resizableColumns="true"
									liveResize="true" rowIndexVar="index" rowKey="#{kaoqin.id}"
									filteredValue="#{kaoqinManagementBean.kaoqinFilteredList}"
									emptyMessage="没有相应结果">
									<p:ajax event="filter" global="true"
										update="@form:kaoqintable1" />
									<p:ajax event="rowEdit"
										listener="#{kaoqinManagementBean.changeStatus}" />
									<p:column filterBy="#{kaoqin.studentname}"
										filterMatchMode="contains">
										<f:facet name="header">
											<h:outputText value="学员姓名" />
										</f:facet>
										<h:outputText value="#{kaoqin.studentname}" />
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText value="班级名称" />
										</f:facet>
										<h:outputText value="#{kaoqin.classname}">
										</h:outputText>
									</p:column>
									<p:column sortBy="#{kaoqin.timesheettime}">
										<f:facet name="header">
											<h:outputText value="上课日期" />
										</f:facet>
										<h:outputText value="#{kaoqin.timesheettime}">
											<f:convertDateTime pattern="yyyy/MM/dd" timeZone="GMT+8" />
										</h:outputText>
									</p:column>
									<p:column sortBy="#{kaoqin.status}">
										<f:facet name="header">
											<h:outputText value="上课状态" />
										</f:facet>
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{kaoqin.status}">
												</h:outputText>
											</f:facet>
											<f:facet name="input">
												<p:selectOneMenu id="status" value="#{kaoqin.status}">
													<f:selectItem itemLabel="上课" itemValue="上课" />
													<f:selectItem itemLabel="请假" itemValue="请假" />
													<f:selectItem itemLabel="顺延" itemValue="顺延" />
													<f:selectItem itemLabel="空白" itemValue="空白" />
												</p:selectOneMenu>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText value="课时（小时）" />
										</f:facet>
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{kaoqin.classhours}">
												</h:outputText>
											</f:facet>
											<f:facet name="input">
												<p:inputText value="#{kaoqin.classhours}" type="number">
												</p:inputText>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column exportable="false">
										<f:facet name="header">
											<h:outputText value="评价" />
										</f:facet>
										<h:outputText value="#{kaoqin.rating} 星">
										</h:outputText>
									</p:column>
									<p:column exportable="false">
										<f:facet name="header">
											<h:outputText value="变更" />
										</f:facet>
										<p:rowEditor />
									</p:column>
								</p:dataTable>
								<p:separator></p:separator>
								<p:panelGrid columns="1" layout="tabular">
									<p:commandButton value="导出到  Excel文件" ajax="false">
										<p:dataExporter type="csv" target="kaoqintable1"
											fileName="kaoqin" pageOnly="false" encoding="GBK" />
									</p:commandButton>
								</p:panelGrid>
							</h:form>
						</p:panel>
					</p:tab>
					<p:tab title="学员考勤记录">
						<p:panel header="考勤记录查询">
							<h:form id="form3">
								<p:panelGrid columns="4" layout="tabular">
									<p:outputLabel value="学员姓名" />
									<p:autoComplete value="#{kaoqinManagementBean.studentName}"
										completeMethod="#{xueyuanManagmentBean.queryByXueyuanName}"
										var="xueyuan" itemLabel="#{xueyuan.name}"
										itemValue="#{xueyuan.name}" />
									<p:commandButton id="querykaoqinbystudent" value="查询"
										actionListener="#{kaoqinManagementBean.querybystudentname}"
										update="@form:kaoqintable2">
									</p:commandButton>

								</p:panelGrid>

								<p:separator></p:separator>

								<p:dataTable id="kaoqintable2" var="kaoqin"
									value="#{kaoqinManagementBean.kaoqinQueryList}" editable="true"
									paginator="true" rows="50" resizableColumns="true"
									liveResize="true" rowIndexVar="index" rowKey="#{kaoqin.id}"
									filteredValue="#{kaoqinManagementBean.kaoqinFilteredList}"
									emptyMessage="没有相应结果">
									<p:ajax event="filter" global="true"
										update="@form:kaoqintable2" />
									<p:ajax event="rowEdit"
										listener="#{kaoqinManagementBean.changeStatus}" />
									<p:column>
										<f:facet name="header">
											<h:outputText value="学员姓名" />
										</f:facet>
										<h:outputText value="#{kaoqin.studentname}" />
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText value="班级名称" />
										</f:facet>
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{kaoqin.classname}">
												</h:outputText>
											</f:facet>
											<f:facet name="input">
												<p:selectOneMenu value="#{kaoqin.classname}">
													<f:selectItems value="#{banjiManagmentBean.banjiList}"
														var="banji" itemLabel="#{banji.name}"
														itemValue="#{banji.name}" />
												</p:selectOneMenu>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column sortBy="#{kaoqin.timesheettime}">
										<f:facet name="header">
											<h:outputText value="上课日期" />
										</f:facet>
										<h:outputText value="#{kaoqin.timesheettime}">
											<f:convertDateTime pattern="yyyy/MM/dd" timeZone="GMT+8" />
										</h:outputText>
									</p:column>
									<p:column sortBy="#{kaoqin.status}">
										<f:facet name="header">
											<h:outputText value="上课状态" />
										</f:facet>
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{kaoqin.status}">
												</h:outputText>
											</f:facet>
											<f:facet name="input">
												<p:selectOneMenu id="status" value="#{kaoqin.status}">
													<f:selectItem itemLabel="上课" itemValue="上课" />
													<f:selectItem itemLabel="请假" itemValue="请假" />
													<f:selectItem itemLabel="顺延" itemValue="顺延" />
													<f:selectItem itemLabel="空白" itemValue="空白" />
													<f:selectItem itemLabel="已补课" itemValue="已补课" />
												</p:selectOneMenu>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText value="课时（小时）" />
										</f:facet>
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{kaoqin.classhours}">
												</h:outputText>
											</f:facet>
											<f:facet name="input">
												<p:inputText value="#{kaoqin.classhours}" type="number">
												</p:inputText>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column exportable="false">
										<f:facet name="header">
											<h:outputText value="评价" />
										</f:facet>
										<h:outputText value="#{kaoqin.rating} 星">
										</h:outputText>
									</p:column>
									<p:column exportable="false" width="5%">
										<f:facet name="header">
											<h:outputText value="变更" />
										</f:facet>
										<p:rowEditor />
									</p:column>
									<p:columnGroup type="footer">
										<p:row style="font-weight: bold">
											<c:forEach items="#{kaoqinManagementBean.totalHours}"
												var="totalHours">
												<c:if test="#{!fn:contains(totalHours.status, '顺延')}">
												<p:column style="text-align:right">
													<f:facet name="footer">
														<h:outputText value="#{totalHours.status}课时总计:" />
													</f:facet>
												</p:column>
												<p:column footerText="#{totalHours.totalhours} 小时" />
												</c:if>
												<c:if test="#{!fn:contains(totalHours.status, '顺延')}">
													<c:set var="total" value="#{total + totalHours.totalhours}" />
												</c:if>
											</c:forEach>
										</p:row>
										<p:row style="font-weight: bold">
											<c:if
												test="#{fn:length(kaoqinManagementBean.totalHours) > 0}">
												<p:column style="text-align:right">
													<f:facet name="footer">
														<h:outputText value="缴费课时总计:" />
													</f:facet>
												</p:column>
												<p:column
													footerText="#{kaoqinManagementBean.totalHours[0].givehours * kaoqinManagementBean.totalHours[0].classhours} 小时" />
												<p:column style="text-align:right">
													<f:facet name="footer">
														<h:outputText value="有效课时总计:" />
													</f:facet>
												</p:column>
												<p:column footerText="#{total} 小时" />
												<p:column style="text-align:right">
													<f:facet name="footer">
														<h:outputText value="剩余课时总计:" />
													</f:facet>
												</p:column>
												<p:column
													footerText="#{kaoqinManagementBean.totalHours[0].givehours * kaoqinManagementBean.totalHours[0].classhours - total} 小时" />
											</c:if>
										</p:row>
										<p:row style="font-weight: bold">
											<c:if
												test="#{fn:length(kaoqinManagementBean.totalHours) > 0}">
												<p:column style="text-align:right">
													<f:facet name="footer">
														<h:outputText value="缴费课时总计:" />
													</f:facet>
												</p:column>
												<p:column
													footerText="#{kaoqinManagementBean.totalHours[0].givehours} 课时" />
												<p:column style="text-align:right">
													<f:facet name="footer">
														<h:outputText value="有效课时总计:" />
													</f:facet>
												</p:column>
												<p:column footerText="#{total / kaoqinManagementBean.totalHours[0].classhours} 课时" />
												<p:column style="text-align:right">
													<f:facet name="footer">
														<h:outputText value="剩余课时总计:" />
													</f:facet>
												</p:column>
												<p:column
													footerText="#{kaoqinManagementBean.totalHours[0].givehours - total / kaoqinManagementBean.totalHours[0].classhours} 课时" />
											</c:if>
										</p:row>
									</p:columnGroup>
								</p:dataTable>
								<p:separator></p:separator>
								<p:panelGrid columns="1" layout="tabular">
									<p:commandButton value="导出到  Excel文件" ajax="false">
										<p:dataExporter type="csv" target="kaoqintable2"
											fileName="xueyuankaoqin" pageOnly="false" encoding="GBK" />
									</p:commandButton>
								</p:panelGrid>
							</h:form>
						</p:panel>
					</p:tab>
				</p:tabView>
			</p:layoutUnit>
		</p:layout>
	</f:view>
</h:body>
</h:html>